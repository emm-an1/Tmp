import numpy as np
from scipy.interpolate import UnivariateSpline

def smooth_spline(df, x_col='x', y_col='y'):
    x = df[x_col].values
    y = df[y_col].values
    
    sort_idx = np.argsort(x)
    x_sorted = x[sort_idx]
    y_sorted = y[sort_idx]
    
    spline = UnivariateSpline(x_sorted, y_sorted, k=3)
    y_smooth_sorted = spline(x_sorted)
    
    # Map back to original order
    y_smooth = np.empty_like(y_smooth_sorted)
    y_smooth[sort_idx] = y_smooth_sorted
    
    result = df.copy()
    result[f'{y_col}_smooth'] = y_smooth
    return result
