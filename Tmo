fast_node = NodeRegistry.get("AD1 Curncy_fast")

mv = fast_node.mv()
returns = fast_node.instrument_returns()

# Compute pnl manually
instruments = fast_node.instruments()
manual_pnl = sum(mv[inst].shift(1) * returns[inst] for inst in instruments)

# Compare with node's pnl
node_pnl = fast_node.pnl()[fast_node.name]

# Check
print("Manual pnl (first 5):")
print(manual_pnl.head())

print("\nNode pnl (first 5):")
print(node_pnl.head())

print("\nMatch (ignoring NaN):")
print(manual_pnl.dropna().equals(node_pnl.dropna()))

# Or check max difference
diff = (manual_pnl - node_pnl).abs().max()
print(f"\nMax difference: {diff}")
